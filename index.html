<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>秒杀你...</title><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1"><link rel="stylesheet" href="lib/all2.css"><link rel="shortcut icon" href="favicon.ico"><script type="text/javascript">document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);</script>
    <style type="text/css">
    .view{
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
    .box{
        position: absolute;
        left:10%;
        top:10%;
        width: 320px;
        height: 200px;
        background: url("img/p1_pic7.png") no-repeat center center;
        background-size: 100% 100%;
        backface-visibility: hidden;
        overflow: hidden;
        margin-top: 50px;
        opacity: 0;
    }
    #cas{
        opacity: 1;
        -webkit-transition:opacity .5s;
        -ms-transition:opacity .5s;
        -moz-transition:opacity .5s;
    }
    
    .noOp{
        opacity: 0 !important;
    }
    </style>
</head>
<body>
    <!-- loading -->
    <!--     <div class="img logImg"><div class="sp"><p class="p1"></p></div><div class="num">0%</div><div class="num2"><img src="img/p0_pic4.png"></div></div> -->
    <div id="swiperBox" class="swiper-container swiper-container-h opacity0" dir="rtl">
        <div class="swiper-wrapper swiper-wrapper1">
            <!--第一页开始-->
            <div class="swiper-slide" id="page1">
                <div class="slide_sec1 sec">
                  <!--   <div class="page1_img1 page1_img1_bg"><img class="blocks" src="img/bg1_1.png" alt=""></div> -->
                    <!-- <p class="page_img2 page1_Img"><img class="blocks" src="img/page1_03.png" class="" alt=""></p> -->

                    <div class="view">
                        <div class="box" id="bb">
                            <canvas id="cas" ></canvas>
                        </div>
                    </div>


                </div>
            </div>
            <!--第一页结束-->

    
            <!--第二页开始-->
            <div class="swiper-slide swiper-no-swiping" id="page2">

                <div class="slide_sec2 sec">
                    <div class="page2_img">
                        <img src="img/big_bg.png" alt="">
                    </div>

    
                    <div class="sec_common2 opacity0" >
                        <img class="blocks sec_common2Img1 fadeOutRight" src="img/com_pic2.png" alt="">
                        <img class="blocks sec_common2Img1" src="img/com_pic1.png" alt="">
                    </div>


                    <div class="sec1">
                        <div class="sec_img1">
                            <img class="p1_pic1 blocks" src="img/p1_pic1.png" alt="">
                            <img class="p1_pic2 page_rotate p1_pic" src="img/p1_pic2.png" alt="">
                            <img class="p1_pic3 page_rotate p1_pic" src="img/p1_pic3.png" alt="">
                        </div>

                        <div class="sec1_img2 swing sec1_2s sec_Img position_a">
                            <div class="sec2Img">
                                <img src="img/p1_pic4.png" class="blocks" alt="">
                                <div class="sec2Img_div">
                                </div>
                            </div>
                            
                        </div>

                        <div class="sec1_img3 sec_Img sec1_3s position_a">
                            <img src="img/p1_pic5.png" class="blocks" alt="">
                        </div>

                        <div class="sec1_img4 sec_Img sec1_4s position_a">
                            <img src="img/p1_pic6.png" class="blocks" alt="">
                        </div>
        
                        <div class="sec1_img5 sec1_5s position_a">
                            <img src="img/p2_pic1.png" class="blocks" alt="">
                        </div>  


                    </div>

                    <div class="sec2 sec_div">
                        <img src="img/p3_pic1.png" class="blocks" alt="">




                    </div>

                    <div class="sec3 sec_div">
                        <img src="img/p4_pic1.png" class="blocks" alt="">
                    </div>
                </div>
            </div>
             <!--第二页结束-->


            </div>
                <div class="swiper-pagination swiper-pagination2" style="display:none"></div>
            </div>
        </div>
            <!--第三页结束-->
        </div>
        <!-- Add Pagination -->
        <div class="swiper-pagination swiper-pagination1" style="display:none;"></div>
        <!-- Add Navigation -->
        <div class="swiper-button-prev" style="display:none;"></div>
        <div class="swiper-button-next" style="display:none;"></div>

    </div>
    <!-- Swiper JS -->
    <script type="text/javascript" src="lib/all.js"></script>

    <script type="text/javascript">

    var step_funs = 0,
        step_fun_width = "",
        step_fun_mar = "";
    var ints = {
        that:this,
        flag:true,
        init:function(){
            var flag = this.flag;
            this.countdown_time();
            this.audio_control(flag);
            this.canvas();
        },
        tapClick:function(){
            return "ontouchstart" in document ? "tap" : "click";
        },
        audio_control:function(boolearn){
            var audio_btn = $('#audio_btn'),
                audio = $("#media")[0],
                Istrue_flase = boolearn;
                audio_btn.on('click',function(){
                    var that = $(this);
                    if(Istrue_flase == true){
                        audio.pause();
                        Istrue_flase = false;
                        that.addClass('off');
                    }else if(Istrue_flase == false){
                        audio.play(); 
                        Istrue_flase = true; 
                        that.removeClass('off');
                    }
                });
            
        },
        countdown_time:function(){
            var i=0,
                logImg = $('.logImg'),
                that = this,
                timer;
                that.swiperH();
            /* timer=setInterval(function(){
                if(i>=100){
                    //更该页面
                    clearInterval(timer);
                    that.swiperH();
                    //that.swiperV();
                    // return false;
                    logImg.hide();
                    // $(".sex").find("a").on("tap",function(){
                    //     $(".sex").hide();
                    // });
                    // $(".constellation").find("dl").on("tap",function(){
                    //     $(".constellation").hide();
                    // });
                    return false;
                } 
                i+=2;
                logImg.find(".p1").css("width",i+"%");
                logImg.find(".num").html(i+"%");
            },50);//100
            */
        },
        swiperH:function(){
            var opacity0 = $('#swiperBox');
            opacity0.css('opacity','1');
            var swiperH = new Swiper('.swiper-container.swiper-container-h', {
                pagination: '.swiper-pagination.swiper-pagination1',
                paginationClickable: true,
                noSwiping : true,
                effect : 'fade',
                nextButton: '.swiper-button-next',
                prevButton: '.swiper-button-prev',
                onTouchStart: function(swiper,even){
                    //console.log(swiper.activeIndex);  

                    // if(swiper.activeIndex == 0){
                    //     return false;
                    // }   
                    // a =  even.changedTouches[0].clientX;
                    // console.log(a);
                },
                onTouchMove: function(swiper,even){
                    // console.log(even.touches[0].clientX)
                    // console.log(even.changedTouches[0].clientX);
                    // console.log(even);

                  //你的事件
                },onTouchEnd:function(swiper,even){
                    setTimeout(function(){
                        $('.sec_common2').css('opacity','1');
                    },1000);
                }

            });
            this.swiperH_click(swiperH);
        },
        swiperH_click:function(swiperH){

            var that = this;
            var qic = $('.page_img2');
            qic.on('click',function(){
                $('.swiper-pagination1 span').eq(1).click();
                setTimeout(function(){
                    $('.sec_common2').css('opacity','1');
                },1000);
            });






            var start_x,move_x,end_x,ins = 0,
                flag = true;


                var touStart_step = 0;
                var is_touStart_step = 0;
                var start_mover = "";


            $('#page2').on('touchstart',function(e) {
                $('.sec_common2').css('opacity','0');
                var _touch = e.originalEvent.targetTouches[0]; 
                    start_x = _touch.pageX;
                    touStart_step++;
                    start_mover = "";
                    is_touStart_step = 0;
                    //console.log(start_x);

            });
           
            $('#page2').on('touchmove',function(e) {
                var _touch = e.originalEvent.targetTouches[0]; 
                move_x = _touch.pageX;
                  
                if(ins == 0 || (flag == true && ins <= 2 )){
             
             
                    is_touStart_step = 22;
                  

                    start_mover = move_x-start_x;

                      //console.log(start_mover);

                    if(start_mover > start_x){
                        is_touStart_step++;
                        $('.page2_img img').css({
                            '-webkit-transform':'rotate('+is_touStart_step+'deg)',
                            '-moz-transform':'rotate('+is_touStart_step+'deg)',
                            'transform':'rotate('+is_touStart_step+'deg)'
                        });
                    }else if(start_mover < start_x){
                        is_touStart_step--;
                        $('.page2_img img').css({
                            '-webkit-transform':'rotate('+-is_touStart_step+'deg)',
                            '-moz-transform':'rotate('+-is_touStart_step+'deg)',
                            'transform':'rotate('+-is_touStart_step+'deg)'
                        });
                    }


                }
                
                if(ins == 0){
                    var moveX = move_x-200;
                    $('.sec_Img').css({'-webkit-transform':'translate3d('+(move_x*1+80)+'px,0,0)','transform':'translate3d('+(move_x*1+80)+'px,0,0)'});
                   $('.sec1_img5').css({'-webkit-transform':'translateX('+moveX+'px)','transform':'translateX('+moveX+'px)'})
                }


            });
            var timrs1 = "";
            $('#page2').on('touchend',function(e) {
                
                if(flag == false){
                    return false;
                }

                $('.sec_Img').hide();
                var _touch = e.originalEvent.changedTouches[0]; 
                end_x =  _touch.pageX;
               
                var Calculation_x = move_x - start_x;
                    
                if(Calculation_x > 0){

                    if(ins == 0){
                        var deg = ins+1 * 72;
                    }else{
                        var deg = ins * 72;
                    }

                    ins++;
                    if(ins >= 4){
                        $('.swiper-pagination1 span').eq(2).click();
                        $('.sec_common2').css('opacity','0');

                        setTimeout(function(){
                            that.swiperV();
                        },400);

                        swiperH.destroy(false);
                        return false;
                    }   
                    $('.page2_img img').css({
                        '-webkit-transform':'rotate('+deg+'deg)',
                        '-moz-transform':'rotate('+deg+'deg)',
                        'transform':'rotate('+deg+'deg)'
                    });

                    flag = false;
                    clearInterval(timrs1);
                    timrs1 = setTimeout(function(){
                        flag = true;
                        $('.sec_common2').css('opacity','1');
                        if(ins == 1){

                        }else if(ins == 2){
                            $('.sec1').css('opacity','0');
                            $('.sec2').css('opacity','1');

                        }else if(ins == 3){
                            $('.sec2').css('opacity','0');
                            $('.sec3').css('opacity','1');
                        }             
                    },1300);
                }
            });

            $('button').on('tap',function(){
                $('.swiper-pagination1 span').eq(2).click();
            });


        },
        canvas:function(){
            var arrs = [[{x1:0},{y1:42},{x2:undefined},{y2:undefined}],[{x1:-34},{y1:42},{x2:-4},{y2:33}],[{x1:-4},{y1:33},{x2:43},{y2:22}],[{x1:43},{y1:22},{x2:95},{y2:8}],[{x1:95},{y1:8},{x2:146},{y2:-9}],[{x1:146},{y1:-9},{x2:198},{y2:-23}],[{x1:198},{y1:-23},{x2:264},{y2:-40}],[{x1:264},{y1:-40},{x2:325},{y2:-59}],[{x1:325},{y1:-59},{x2:387},{y2:-80}],[{x1:387},{y1:-80},{x2:450},{y2:-97}],[{x1:450},{y1:-97},{x2:506},{y2:-115}],[{x1:379},{y1:-6},{x2:undefined},{y2:undefined}],[{x1:379},{y1:-6},{x2:370},{y2:-3}],[{x1:370},{y1:-3},{x2:362},{y2:-1}],[{x1:362},{y1:-1},{x2:348},{y2:3}],[{x1:348},{y1:3},{x2:272},{y2:19}],[{x1:272},{y1:19},{x2:226},{y2:27}],[{x1:226},{y1:27},{x2:174},{y2:35}],[{x1:174},{y1:35},{x2:125},{y2:45}],[{x1:125},{y1:45},{x2:63},{y2:51}],[{x1:63},{y1:51},{x2:3},{y2:61}],[{x1:3},{y1:61},{x2:-59},{y2:69}],[{x1:-59},{y1:69},{x2:-119},{y2:80}],[{x1:-119},{y1:80},{x2:-173},{y2:88}],[{x1:-173},{y1:88},{x2:-222},{y2:96}],[{x1:7},{y1:124},{x2:68},{y2:124}],[{x1:68},{y1:124},{x2:129},{y2:124}],[{x1:129},{y1:124},{x2:184},{y2:124}],[{x1:184},{y1:124},{x2:243},{y2:124}],[{x1:243},{y1:124},{x2:306},{y2:124}],[{x1:306},{y1:124},{x2:364},{y2:124}],[{x1:364},{y1:124},{x2:425},{y2:124}],[{x1:425},{y1:124},{x2:481},{y2:124}],[{x1:481},{y1:124},{x2:522},{y2:124}],[{x1:522},{y1:124},{x2:556},{y2:124}],[{x1:556},{y1:124},{x2:584},{y2:124}],[{x1:584},{y1:124},{x2:609},{y2:124}],[{x1:609},{y1:124},{x2:624},{y2:124}],[{x1:624},{y1:124},{x2:639},{y2:124}],[{x1:639},{y1:124},{x2:651},{y2:124}],[{x1:651},{y1:124},{x2:662},{y2:124}]
            ];
            var canvas = document.getElementById("cas"), ctx = canvas.getContext("2d");
            var x1, y1, a = 30;
            var saveDot = [];
            var canvasBox = document.getElementById("bb");
            canvas.width = canvasBox.clientWidth;
            canvas.height = canvasBox.clientHeight;
            var img = new Image();
            img.src = 'img/pic2.jpg';
            img.onload = function () {
                var w = canvas.height*img.width/img.height;
                ctx.drawImage(img, (canvas.width-w)/2, 0, w, canvas.height);
                setTimeout(function(){tapClip()},1500);
                
            };

                function tapClip() {
                    $('.box').css('opacity','1');
                    var area;
                    var x2,y2,
                    arr = [],
                    S = 0,timer;
                    ctx.lineCap = "round";
                    ctx.lineJoin = "round";
                    ctx.lineWidth = a * 5;
                    ctx.globalCompositeOperation = "destination-out";

                
                    function getClipAreas(x1,y1){
                        var x = x1,
                            y = y1;
                        var ndom = canvas;

                        while(ndom.tagName!=="BODY"){
                            x -= ndom.offsetLeft;
                            y -= ndom.offsetTop;
                            ndom = ndom.parentNode;
                        }
                        return {
                            x: x,
                            y: y
                        }
                    }
                
                
                    for(var i = 0;i<arrs.length;i++){
                        eval("field"+i+" = [];");
                        eval("field"+i).push(arrs[i])
                        arr[i]=[];
                    }
                    clearInterval(timer);
                    timer = setInterval(function(){
                        if(arr.length != arrs.length){clearInterval(timer);return false;}
                        S++;
                        if(S >= arr.length){
                            clearInterval(timer);
                            return false;
                        }
                        sets(S);
                    },40-S);


                    function sets(s){
                        var setval = eval("field"+s),
                            setval_0 = setval[0],
                            x1 = setval_0[0].x1,
                            y1 = setval_0[1].y1,
                            arrs_3 = setval_0[2].x2,
                            arrs_4 = setval_0[3].y2;
                            area = getClipAreas(x1, y1);
                            x2 =arrs_3;y2 = arrs_4;
                            drawLine(x1, y1, x2, y2);
                            x1 = x2;y1 = y2;

                    }



                    function drawLine(x1, y1, x2, y2){
                        ctx.save();
                        ctx.beginPath();
                            ctx.moveTo(x1, y1);
                            ctx.lineTo(x2, y2);
                            ctx.stroke();
                            ctx.restore();
                    }

                }
            

        },
        swiperV:function(){
            var that = this;
            var swiperV = new Swiper('.swiper-container.swiper-container-v', {
                pagination: '.swiper-pagination.swiper-pagination2',
                paginationClickable: true,
                direction: 'vertical',
                spaceBetween: 0 ,
                onInit: function(swiper){ 
                  swiperAnimateCache(swiper);
                  swiperAnimate(swiper);
                }, 
                onSlideChangeEnd: function(swiper){ 
                  swiperAnimate(swiper); 
                },
                onTouchStart: function(swiper,even){
                },
                onTouchMove: function(swiper,even){
                  //你的事件
                },onTouchEnd:function(swiper,even){
                    
                },onSlideChangeStart: function(swiper){

                }
            });
    
           that.swiperV_click(swiperV);
        },swiperV_click:function(swiperV){
            var step = 500,step_timer,that = this,is = 0,
                btn_xin = $('.vertica2_img2_div'),bth_lower = $('#bth_lower'),bth_lower2 = $('#bth_lower2')
            btn_xin.on('touchstart',function(e) {
                e.preventDefault();
                var that_this = $(this).siblings('img');
                step_timer = setInterval(function(){
                    step--;
                    if(step == 400){
                        that.step_fun();
                        that_this.attr('src','img/p6_pic4.png');
                    }else if(step == 360){
                        that.step_fun();
                    }else if(step == 320){
                        that.step_fun();
                    }else if(step == 260){
                        that.step_fun();
                    }else if(step == 240){
                        that.step_fun();
                    }else if(step < 200 || step <= 0){
                        that.step_end();
                        clearInterval(step_timer);
                    }else if(step <= 0){
                        clearInterval(step_timer);
                    }
                },0);
            });
            btn_xin.on('touchmove',function(e) {
                clearInterval(step_timer);
                $(this).siblings('img').attr('src','img/p6_pic4.png');
            })
            btn_xin.on('touchend',function(e) {
                clearInterval(step_timer);
                step_funs >= 5 && that.step_end();
            });
            bth_lower.on('click',function(){
                $('.swiper-pagination2 span').eq(2).click();
            })
            bth_lower2.on('click',function(){
                $('.vertica3_img1').css('opacity','1');
            })
         
        },
        step_fun:function(){
                step_funs++;
                if(step_funs == 1){
                    step_fun_mar = "-40px";
                }else if(step_funs == 2){
                    step_fun_mar = "-53px"
                }else if(step_funs == 3){
                    step_fun_mar = "-10px";
                    step_fun_mar = "-28px";
                }
                var x = 100;       
                var y = 900;  
                var num = Math.floor(Math.random() * 3 + 1);
                var index=$('.demo').children('img').length;
                var rand = parseInt(Math.random() * (x - y + 1) + y-10); 
                
                $(".demo").append("<img class='demo_img_scale' src=''>");
                $('.demo img:eq(' + index + ')').attr('src','img/p'+num+'.png');
               
                $(".demo img").animate({
                    bottom:"800px",
                    opacity:"0",
                    left: rand,
                    marginLeft:step_fun_mar,
                    width:'32px'
                },3000);

          
        },
        step_end:function(){
            $('.vertica2_p').css('opacity','1')
        }
    }
   
    window.onload= function(){
        ints.init();
    }

 
    </script>
</body>
</html>